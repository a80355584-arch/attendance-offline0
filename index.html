<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Attendance Offline</title>
</head>
<body>

<h2>ğŸ“‹ ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±</h2>
<div id="status">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxARLTg5bYpJjOPVMbW-Oopvvh5h0tI33J6swRkKs1i5216diTMn46Z13ve_PUSaSNG/exec"; // Ø±Ø§Ø¨Ø·Ùƒ
const params = new URLSearchParams(window.location.search);
const code = params.get("code");

if (!code) {
  document.getElementById("status").innerText = "âŒ QR ØºÙŠØ± ØµØ§Ù„Ø­";
  throw "";
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø©
let queue = JSON.parse(localStorage.getItem("attendanceQueue") || "[]");

// Ø¥Ø¶Ø§ÙØ© ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
queue.push({
  code: code,
  time: new Date().toISOString()
});

// Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ
localStorage.setItem("attendanceQueue", JSON.stringify(queue));

document.getElementById("status").innerText =
  "âœ… ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…Ø­Ù„ÙŠÙ‹Ø§ (Ø£ÙˆÙÙ„Ø§ÙŠÙ†)";

// Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
syncData();

function syncData() {
  if (!navigator.onLine) return;

  let queue = JSON.parse(localStorage.getItem("attendanceQueue") || "[]");
  if (queue.length === 0) return;

  const item = queue[0];

<form id="attendanceForm" action="https://script.google.com/macros/s/XXXX/exec" method="POST" target="hidden_iframe">
  <input type="hidden" name="code" id="codeInput">
</form>
<iframe name="hidden_iframe" style="display:none;"></iframe>

<script>
function submitAttendance(code) {
  document.getElementById('codeInput').value = code;

  // ØªØ®Ø²ÙŠÙ† Ù…Ø¤Ù‚Øª Offline
  let queue = JSON.parse(localStorage.getItem('attendanceQueue') || '[]');
  queue.push({code: code, time: new Date().toISOString()});
  localStorage.setItem('attendanceQueue', JSON.stringify(queue));

  // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙˆØ±Ù‹Ø§
  document.getElementById('attendanceForm').submit();

  alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±Ùƒ!");
}

// Ù…Ø«Ø§Ù„: Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© Ø¨Ø§Ù„Ù€ QR code
const urlParams = new URLSearchParams(window.location.search);
const code = urlParams.get('code');
if (code) submitAttendance(code);
</script>

}

submitAttendance("12345");
</script>

}

// Ø£ÙˆÙ„ Ù…Ø§ Ø§Ù„Ù†Øª ÙŠØ±Ø¬Ø¹
window.addEventListener("online", syncData);
</script>

</body>
</html>

